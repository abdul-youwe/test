name: Sync Staging to Main (Exclude JSON files)
on:
    push:
        branches:
            - staging

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: checkout
              uses: actions/checkout@v4
            
            # Add step to remove JSON files before creating PR
            - name: Remove JSON files
              run: |
                  git config --global user.email "github-actions[bot]@users.noreply.github.com"
                  git config --global user.name "github-actions[bot]"
                  git rm -rf --cached templates/**/*.json config/**/*.json locales/**/*.json || true
                  git commit -m "Remove JSON files" || true
                  
            - name: merge
              uses: peter-evans/create-pull-request@v5
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
                  branch: staging-sync
                  base: main
                  title: 'Sync: Staging to Main (Excluding JSON files)'
                  body: 'Automated PR to sync staging to main, excluding JSON files from templates, config, and locales directories'
                  delete-branch: true
